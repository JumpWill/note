### 基本认识

云原生的发布订阅消息系统，有 多租户，云原生，灵活的消息系统，Segmented Streams，跨地域复制。

#### 多租户

​       租户和命名空间（namespace）是 Pulsar 支持多租户的两个核心概念。

- 在租户级别，Pulsar 为特定的租户预留合适的存储空间、应用授权与认证机制。

- 在命名空间级别，Pulsar 有一系列的配置策略（policy），包括存储配额、流控、消息过期策略和命名空间之间的隔离策略。

  ![img](https://pic1.zhimg.com/80/v2-797cacd3635941e3c03bfc7fce789da8_1440w.jpg) 

#### 云原生

 Pulsar 使用计算与存储分离的云原生架构，数据从 Broker 搬离，存在共享存储内部。上层是无状态 Broker，复制消息分发和服务；下层是持久化的存储层 Bookie 集群。Pulsar 存储是分片的，这种构架可以避免扩容时受限制，实现数据的独立扩展和快速恢复 。

#### 灵活的消息系统

 Pulsar 做了队列模型和流模型的统一，在 Topic 级别只需保存一份数据，同一份数据可多次消费。以流式、队列等方式计算不同的订阅模型大大提升了灵活度。 

同时pul sar通过事务采用Exactly-0nce (精准-次)在进行消息传输过程中，可以确保数据不丢不重。

#### Segmented Streams

 Pulsar 将无界的数据看作是分片的流，分片分散存储在分层存储（tiered storage）、BookKeeper 集群和 Broker 节点上，而对外提供一个统一的、无界数据的视图。其次，不需要用户显式迁移数据，减少存储成本并保持近似无限的存储。 

#### 跨地域复制

 Pulsar 中的跨地域复制是将 Pulsar 中持久化的消息在多个集群间备份。在 Pulsar 2.4.0 中新增了复制订阅模式(Replicated-subscriptions)，在某个集群失效情况下，该功能可以在其他集群恢复消费者的消费状态，从而达到热备模式下消息服务的高可用 